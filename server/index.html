<html>
<head>
<script type="text/javascript" src="socket.io.min.js"></script>
<script type="text/javascript" src="jquery-3.2.1.min.js"></script>
<style>
  .player.current {
    background-color: lightyellow;
  }
</style>

</head>
<body>
  <div id='actions'></div>
  <div id='game'>
    <div id='board'></div>
    <div id='pot'></div>
    <div id='players'></div>
  </div>
  <div id='special_actions'></div>

<script type="text/javascript" charset="utf-8">
  var socket = io.connect('http://localhost:' + 5000);
  socket.on('full_state', function(data) {
    console.log(data);
    $('#board').text(data.board.join(' '));
    $('#pot').text(data.pots.length ? ('Pot: ' + data.pots.join(', ')) : '');
    var player_divs = []
    for (var i = 0; i < data.players.length; ++i) {
      var p = data.players[i];
      text = '<div class="player ' + (p.is_current ? 'current' : '') + '">' + p.name;
      if (p.place) {
        text += ' &ndash; ' + p.place + ' место'
      } else {
        text += ' ' + p.chips + ' + ' + p.bet;
        if (p.status) {
          text += ' ' + p.status;
        }
        if (p.hand.length) {
          text += ': ' + p.hand.join(' ');
        }
        if (p.combination) {
          text += ' ' + p.combination;
        }
        if (p.win_probs) {
          text += ' '  + p.win_probs.join(' ')
        }
      }
      text += '</div>';
      player_divs.push(text);
    }
    $('#players').html(player_divs.join(''));

    function create_actions(action_div_id, actions) {
      var $actions_div = $('#' + action_div_id);
      $actions_div.html('');
      actions.forEach(function(action) {
            var $action = $("<input/>").attr('type', 'submit').attr('value', action.text);
            $actions_div.append($action);
            var args_inputs = []
            action.args.forEach(function(arg) {
                  var $arg = $("<input/>").attr('type', 'number').attr('name', arg);
                  args_inputs.push($arg);      
                  $actions_div.append($arg);
                });
            $actions_div.append($('<br/>'));
            $action.click(function () {
                  var data = {'action_type': action.type}
                  args_inputs.forEach(function(arg_input) {
                        data[arg_input.attr('name')] = arg_input.val();
                      });
                  console.log(data)
                  socket.emit('make_action', data);
                });
          });
    }

    create_actions('actions', data.actions);
    create_actions('special_actions', data.special_actions);

  });

  /*setInterval(function () {
        console.log('emit next_phase');
        socket.emit('next_phase');
      }, 2000);*/
</script>
</body>
</html>
